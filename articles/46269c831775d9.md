---
title: "Nix で Agent Skills を管理する"
emoji: "🦔"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

## はじめに
Model Context Protocol だなんだと言っていた時期ももう懐かしく、10 月に Agent Skills なるものが Anthropic から発表され、12 月 18 日にオープンな規格となりました。ここ一週間ずっと驚き屋が驚いててやかましかったですね。

https://platform.claude.com/docs/ja/agents-and-tools/agent-skills/overview


MCP Server についてはすでに Nix を用いて宣言的に管理する手法が存在しますが、まだ Agent Skills について管理する手法は見当たらないように思えました。非 Nix での手法としては Open Skills なるものがあるらしいですが、微妙にやってることが違いそう？ですね（Nix でないので興味が湧かずリサーチしていない）

Agent Skills で LLM に悪意のある動作をさせることが出来るのかはさておき、警戒することに越したことはありません。Nix flakes で依存関係をロックしておけば、未来のコミットにおいて悪意のあるプロンプトに差し替えられたとしても問題ありません。

これを期待して、Nix を用いた Agent Skills 設定のためのフレームワークである agent-skills-nix を作成しました。

## なぜ Nix？
先ほど述べたように、LLM へのプロンプトインジェクションへの対策のためです。
というのは建前で、私は home-manager ですべての設定を管理しているので Agent Skills についても一元管理したかっただけです。

## 実装
MCP Server とは違い、Agent Skills は単なるテキストファイルとそれに付随するスクリプトがあるだけですから、単に各エージェントごとのディレクトリにシンボリックリンクを貼ってやればよさそうです。
最初は全てのエージェントについてシンボリックリンクで全て配置する想定でしたが、Codex については実体がなければ Agent Skills を読み込んでくれないらしく、実体を配置するオプションも実装しました。
